# Example Setup

### Prerequisites 

* [mirrord](https://mirrord.dev/)
* Available Kubernetes Cluster
* [NodeJS](https://nodejs.org/en/) + [Yarn](https://www.npmjs.com/package/yarn)
* (optional) [golang-migrate](https://github.com/golang-migrate/migrate)


### Clone Repo
First clone the example repo

```bash
git clone https://github.com/metalbear-co/nodejs-example.git
cd nodejs-example
```

### Setup Cluster
For this example you will need to create a few deployments and services

```bash
kubectl apply -f app.yaml
```

This command will create four deployments and relevant services
* example-pg - Postgres Database
* example-idp - [Dexidp](https://dexidp.io/) OIDC provider
* example-blog - NodeJS application located in ./blog
* example-auditor - NodeJS application located in ./auditor

After first initialization the example-idp and example-blog deployments may not work. To fix this we need to run some migrations.

### Migrations

First establish a connection to the cluster's database

```
kubectl port-forward svc/example-pg 5432:5432
```

If you have golang-migrate installed run in a separate terminal session

```bash
./run_migration.sh
```

Or if you don't have golang-migrate installed then you'll need to execute the sql with the suffix `.up.sql` files located in `./migrations` to create the databases.
After switching to `blog` database from the previous action run sqls with the suffix `.up.sql` located in `./migrations/blog` .
You can use any cli/gui (psql, pgAdmin or DBeaver for example) that can connect to Postgres with the following credentials for this step

```
host: localhost
port: 5432
user: postgres
pass: example
```

#### [Next Step](03.%20Mirrord%20Mirroring.md)