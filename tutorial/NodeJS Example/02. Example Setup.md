# Example Setup

### Prerequisites 

* [Mirrord](https://mirrord.dev/)
* Available Kubernetes Cluster (perferably local for this example)
* [NodeJS](https://nodejs.org/en/) + [Yarn](https://www.npmjs.com/package/yarn)
* (optinal) [golang-migrate](https://github.com/golang-migrate/migrate)


### Clone Repo
First clone the example repo

```bash
git clone https://github.com/metalbear-co/nodejs-example.git
cd nodejs-example
```

### Setup Cluster
To show the example you will need to create a few deployments and services

```bash
kubectl apply -f app.yaml
```

This command will create 3 deployments and relevant services
* example-pg - Postgres Database - http://localhost:30080/
* example-idp - [Dexidp](https://dexidp.io/) OIDC provider - http://localhost:30056/oidc/.well-known/openid-configuration
* example-blog - NodeJS application located in ./blog - postgresql://postgres:example@localhost:30432/

After first initialisation the example-idp and example-blog deployments may not work out of the box for to fix this we need to run migrations

### Migrations

If you have golang-migrate installed simply run

```bash
./run_migration.sh
```

or if you don't have golang-migrate insalled then you'll simply need to execute the sql files located in `./migrations` to create the databases and after reconnecting to `blog` database the previus action created run all sqls located in `./migrations/blog`

### Taredown
After You are done with the example you can taredown the cluster with

```bash
kubectl delete -f app.yaml
```