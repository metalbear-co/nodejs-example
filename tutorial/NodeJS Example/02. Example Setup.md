# Example Setup

### Prerequisites 

* [mirrord](https://mirrord.dev/)
* Available Kubernetes Cluster
* [NodeJS](https://nodejs.org/en/) + [Yarn](https://www.npmjs.com/package/yarn)
* (optional) [golang-migrate](https://github.com/golang-migrate/migrate)


### Clone Repo
First clone the example repo

```bash
git clone https://github.com/metalbear-co/nodejs-example.git
cd nodejs-example
```

### Setup Cluster
For this example you will need to create a few deployments and services

```bash
kubectl apply -f app.yaml
```

This command will create four deployments and relevant services
* example-pg - Postgres Database
* example-idp - [Dexidp](https://dexidp.io/) OIDC provider
* example-blog - NodeJS application located in ./blog
* example-auditor - NodeJS application located in ./auditor

After first initialization the example-idp and example-blog deployments will not work. To fix this we need to run some migrations.

### Migrations

First establish a connection to the cluster's database in a sperate shell

```
kubectl port-forward svc/example-pg 5432:5432
```

And then run the migration script

```bash
./run_migration.sh
```

#### [Next Step](03.%20Mirrord%20Mirroring.md)